When I copy code from another file, the formatting is messed up, like this:How can I autoformat this code in vim?Try the following keystrokes:Explanation: gg goes to the top of the file, = is a command to fix the indentation and G tells it to perform the operation to the end of the file.I like to use the program Artistic Style. According to their website:Artistic Style is a source code indenter, formatter, and beautifier for the C, C++, C# and Java programming languages.It runs in Window, Linux and Mac. It will do things like indenting, replacing tabs with spaces or vice-versa, putting spaces around operations however you like (converting if(x<2) to if ( x<2 ) if that\'s how you like it), putting braces on the same line as function definitions, or moving them to the line below, etc. All the options are controlled by command line parameters.In order to use it in vim, just set the formatprg option to it, and then use the gq command. So, for example, I have in my .vimrc:so that whenever I open a .cpp file, formatprg is set with the options I like. Then, I can type gg to go to the top of the file, and gqG to format the entire file according to my standards. If I only need to reformat a single function, I can go to the top of the function, then type gq][ and it will reformat just that function.The options I have for astyle, -T4pb, are just my preferences. You can look through their docs, and change the options to have it format the code however you like.Here\'s a demo. Before astyle:After astyle (gggqG):Hope that helps.The OP asked for auto-formatting, but accepted an answer that does auto-indenting only.Here is the difference:ORIGINALAUTOINDENTAUTOFORMATThe builtin command for properly indenting the code has already been mentioned (gg=G). If you want to beautify the code, you\'ll need to use an external application like indent. Since % denotes the current file in ex mode, you can use it like this:The plugin vim-autoformat lets you format your buffer with only one button press: https://github.com/Chiel92/vim-autoformat. It uses external format programs for that, with a fallback to vim\'s indentation functionality.I like indent as mentioned above, but most often I want to format only a small section of the file that I\'m working on. Since indent can take code from stdin, its really simple:astyle takes stdin too, so you can use the same trick there.I find that clang-format works well.There are some example keybindings in the clang documentationI prefer to use the equalprg binding in vim. This allows you to invoke clang-format with G=gg or other = indent options.Just put the following in your .vimrc file:Maybe you can try the followings\n  $indent -kr -i8 *.cHope it\'s useful for you!I wanted to add, that in order to prevent it from being messed up in the first place you can type :set paste before pasting. After pasting, you can type :set nopaste for things like js-beautify and indenting to work again.Their is a tool called indent.\nyou can download it by (apt-get indent)\nthen root@n0va:~# indent my_program.c