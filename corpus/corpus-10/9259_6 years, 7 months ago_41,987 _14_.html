Is there a way to have a defaultdict(defaultdict(int)) in order to make the following code work?d needs to be built ad-hoc, depending on x.a and x.b elements.I could use:but then I wouldn\'t be able to use:Yes like this:The parameter to the defaultdict constructor is the function which will be called for building new elements. So let\'s use a lambda !Since Python 2.7, there\'s an even better solution using Counter:Some bonus featuresFor more information see PyMOTW - Collections - Container data types and Python Documentation - collectionsI find it slightly more elegant to use partial:Of course, this is the same as a lambda.Others have answered correctly your question of how to get the following to work:An alternative would be to use tuples for keys:The nice thing about this approach is that it is simple and can be easily expanded.  If you need a mapping three levels deep, just use a three item tuple for the key.