How do I check if the current batch script has admin rights?I know how to make it call itself with runas but not how to check for admin rights. The only solutions I\'ve seen are crude hack jobs or use external programs. Well, actually I don\'t care if it is a hack job as long as it works on Windows XP and newer.blak3r / Rushyo\'s solution works fine for everything except Windows 8. Running AT on Windows 8 results in:(see screenshot #1) and will return %errorLevel% 1. So, I went searching for other commands that require elevated permissions. rationallyparanoid.com had a list of a few, so I ran each command on the two opposite extremes of current Windows OSs (XP and 8) in the hopes of finding a command that would be denied access on both OSs when run with standard permissions.  Eventually, I did find one - NET SESSION. A true, clean, universal solution that doesn\'t involve:Each of which have their own security, usability, and portability issues. I\'ve independently confirmed that this works on:(see screenshot #2) So, to use this solution, simply do something like this:Available here, if you\'re lazy: https://dl.dropbox.com/u/27573003/Distribution/Binaries/check_Permissions.bat NET SESSION is a standard command used to "manage server computer connections. Used without parameters, [it] displays information about all sessions with the local computer."So, here\'s the basic process of my given implementation: Windows 8 AT %errorLevel%: NET SESSION on Windows XP x86 - Windows 8 x64: Thank you, @Tilka, for changing your accepted answer to mine. :)Anders solution worked for me but I wasn\'t sure how to invert it to get the opposite (when you weren\'t an admin).Here\'s my solution.  It has two cases an IF and ELSE case, and some ascii art to ensure people actually read it.  :)Rushyo posted this solution here: How to detect if CMD is running as Administrator/has elevated privileges?Works on WinXP --> Win8 (including 32/64 bit versions).EDIT: 8/28/2012 Updated to support Windows 8.  @BenHooper pointed this out in his answer below.  Please upvote his answer.As pointed out by @Lectrode, if you try to run the net session command while the Server service is stopped, you receive the following error message:In this case the %errorLevel% variable will be set to 2.Note The Server service is not started  while in Safe Mode (with or without networking).Something that:So I booted a vanilla Windows XP virtual machine and I started scrolling through the list of applications in the C:\\Windows\\System32 folder, trying to get some ideas. After trials and errors, this is the dirty (pun intended) approach I\'ve come up with:The fsutil dirty command requires admin rights to run, and will fail otherwise. %systemdrive% is an environment variable which returns the drive letter where the operating system is installed. The output is redirected to nul, thus ignored. The %errorlevel% variable will be set to 0 only upon successful execution.Here is what the documentation says:Queries or sets a volume\'s dirty bit. When a volume\'s dirty bit is set, autochk automatically checks the volume for errors the next time the computer is restarted.A volume\'s dirty bit indicates that the file system may be in an inconsistent state. The dirty bit can be set because:If the dirty bit is set when the computer restarts, chkdsk runs to verify the file system integrity and to attempt to fix any issues with the volume. To query the dirty bit on drive C, type:While the solution above works from Windows XP onwards, it\'s worth adding that Windows 2000 and Windows PE (Preinstalled Environment) don\'t come with fsutil.exe, so we have to resort to something else.During my previous tests I noticed that running the sfc command without any parameters would either result in:That is: no parameters, no party. The idea is that we can parse the output and check if we got anything but an error:The error output is first redirected to the standard output, which is then piped to the find command. At this point we have to look for the only parameter that is supported in all Windows version since Windows 2000: /SCANNOW. The search is case insensitive, and the output is discarded by redirecting it to nul.Here\'s an excerpt from the documentation:Scans and verifies the integrity of all protected system files and replaces incorrect versions with correct versions.You must be logged on as a member of the Administrators group to run sfc.exe.Here are some paste-and-run examples:Not only check but GETTING admin rights automatically\naka Automatic UAC for Win 7/8/8.1 ff.: The following is a really cool one with one more feature: This batch snippet does not only check for admin rights, but gets them automatically! (and tests before, if living on an UAC capable OS.)With this trick you don\xc2\xb4t need longer to right klick on your batch file "with admin rights". If you have forgotten, to start it with elevated rights, UAC comes up automatically! Moreoever, at first it is tested, if the OS needs/provides UAC, so it behaves correct e.g. for Win 2000/XP until Win 8.1- tested.The snippet merges some good batch patterns together, especially (1) the admin test in this thread by Ben Hooper and (2) the UAC activation read on BatchGotAdmin and cited on the batch site by robvanderwoude (respect). (3) For the OS identificaton by "VER | FINDSTR pattern" I just don\'t find the reference.)(Concerning some very minor restrictions, when "NET SESSION" do not work as mentioned in another answer- feel free to insert another of those commands. For me running in Windows safe mode or special standard services down and such are not an important use cases- for some admins maybe they are.)one more wayfltmc command is available on every windows system since XP so this should be pretty portable.One more solution tested on XP,8.1,7 (unfortunately does not work on all win10 machines  - see the comments.) - there\'s  one specific variable =:: which is presented only if the console session has no admin privileges.As it is not so easy to create variable that contains = in it\'s name this is comparatively reliable way to check for admin permission (and pretty fast as it does not call external executables) alternative solution:I have two ways of checking for privileged access, both are pretty reliable, and very portable across almost every windows version.This is one of the most reliable methods, because of its simplicity, and the behavior of this very primitive command is very unlikely to  change. That is not the case of other built-in CLI tools like net session that can be disabled by admin/network policies, or commands like fsutils that changed the output on Windows 10.* Works on XP and laterSometimes you don\'t like the idea of touching the user disk, even if it is as inoffensive as using fsutils or creating a empty folder, is\n  it unprovable but it can result in a catastrophic failure if something goes wrong. In this scenario you can just check the registry for privileges.For this you can try to create a key on HKEY_LOCAL_MACHINE using default permissions you\'ll get Access Denied and the ERRORLEVEL == 1, but if you run as Admin, it will print "command executed successfully" and ERRORLEVEL == 0. Since the key already exists it have no effect on the registry. This is probably the fastest way, and the REG is there for a long time.* It\'s not avaliable on pre NT (Win 9X).* Works on XP and laterA script that clear the temp folderThe following tries to create a file in the Windows directory. If it suceeds it will remove it.Note that 06CF2EB6-94E6-4a60-91D8-AB945AE8CF38 is a GUID that was generated today and it is assumed to be improbable to conflict with an existing filename.The cleanest way to check for admin privileges using a CMD script, that I have found, is something like this:This method only uses CMD.exe builtins, so it should be very fast.  It also checks for the actual capabilities of the process rather than checking for SIDs or group memberships, so the effective permission is tested.  And this works as far back as Windows 2003 and XP.  Normal user processes or nonelevated processes fail the directory probe, where as Admin or elevated processes succeed.Some servers disable services that the command "net session" requires.\nThis results in the admin check always saying you don\'t have admin rights when you may have.The whoami /groups doesn\'t work in one case.  If you have UAC totally turned off (not just notification turned off), and you started from an Administrator prompt then issued:you will be running non-elevated, but issuing:will say you\'re elevated.  It\'s wrong.  Here\'s why it\'s wrong:When running in this state, if IsUserAdmin (https://msdn.microsoft.com/en-us/library/windows/desktop/aa376389(v=vs.85).aspx) returns FALSE and UAC is fully disabled, and GetTokenInformation returns TokenElevationTypeDefault (http://blogs.msdn.com/b/cjacks/archive/2006/10/24/modifying-the-mandatory-integrity-level-for-a-securable-object-in-windows-vista.aspx) then the process is not running elevated, but whoami /groups claims it is.really, the best way to do this from a batch file is:You should do net session twice because if someone did an at before hand, you\'ll get the wrong information.Edit: copyitright has pointed out that this is unreliable. Approving read access with UAC will allow dir to succeed. I have a bit more script to offer another possibility, but it\'s not read-only.Old answer belowWarning: unreliableBased on a number of other good answers here and points brought up by and31415 I found that I am a fan of the following:Few dependencies and fast.Note:\nChecking with cacls for \\system32\\config\\system\nwill ALWAYS fail in WOW64, (for example from %systemroot%\\syswow64\\cmd.exe / 32 bit Total Commander) so scripts that run in 32bit shell in 64bit system will loop forever...\nBetter would be checking for rights on Prefetch directory:Win XP to 7 tested, however it fails in WinPE as in windows 7 install.wim there is no such dir nor cacls.exeAlso in winPE AND wow64 fails check with openfiles.exe :In Windows 7 it will errorlevel with "1" with info that "Target system needs to be 32bit operating system"Both check will probably also fail in recovery console.What works in Windows XP - 8 32/64 bit, in WOW64 and in WinPE are: dir creation tests (IF admin didn\'t carpet bombed Windows directory with permissions for everyone...) andandchecks.Also one more note in some windows XP (and other versions probably too, depending on admin\'s tinkering) depending on registry entries directly calling bat/cmd from .vbs script will fail with info that bat/cmd files are not associated with anything...Calling cmd.exe with parameter of bat/cmd file on the other hand works OK:Literally dozens of answers in this and linked questions and elsewhere at SE, all of which are deficient in this way or another, have clearly shown that Windows doesn\'t provide a reliable built-in console utility. So, it\'s time to roll out your own.The following C code, based on Detect if program is running with full administrator rights, works in Win2k+1, anywhere and in all cases (UAC, domains, transitive groups...) - because it does the same as the system itself when it checks permissions. It signals of the result both with a message (that can be silenced with a switch) and exit code.It only needs to be compiled once, then you can just copy the .exe everywhere - it only depends on kernel32.dll and advapi32.dll (I\'ve uploaded a copy).chkadmin.c:1MSDN claims the APIs are XP+ but this is false. CheckTokenMembership is 2k+ and the other one is even older. The last link also contains a much more complicated way that would work even in NT.PowerShell anyone?Here is another one to add to the list ;-)(attempt a file creation in system location)The MODE CON reinitializes the screen and surpresses any text/errors when not having the permission to write to the system location.Alternative: Use an external utility that is designed for this purpose, e.g., IsAdmin.exe (unrestricted freeware).Exit codes:0 - Current user not member of Administrators group1 - Current user member of Administrators and running elevated2 - Current user member of Administrators, but not running elevatedI will explain the code line by line:Users will be annoyed with many more than 1 lines without this.Point where the program starts.Set the filename of the directory to be created.Creates the directory on <DL>:\\Windows (replace <DL> with drive letter).If the ERRORLEVEL environment variable is zero, then echo success message.\nGo to the end (don\'t proceed any further).If ERRORLEVEL is one, echo failure message and go to the end.In case the filename already exists, recreate the folder (otherwise the goto end command will not let this run).Specify the ending pointRemove the created directory.Pause so the user can see the message.Note: The >nul and 2>nul are filtering the output of these commands.net user %username% >nul 2>&1 && echo admin || echo not adminI think the simplest way is trying to change the system date (that requires admin rights):If %date% variable may include the day of week, just get the date from last part of DATE command:I found a user that can use net session even though they are not admin.  I didn\'t look into why.  My workaround is to test if the user can make a folder in the windows folder.Here is my code:Here\'s my 2-pennies worth:I needed a batch to run within a Domain environment during the user login process, within a \'workroom\' environment, seeing users adhere to a "lock-down" policy and restricted view (mainly distributed via GPO sets).A Domain GPO set is applied before an AD user linked login script\nCreating a GPO login script was too per-mature as the users "new" profile hadn\'t been created/loaded/or ready in time to apply a "remove and/or Pin" taskbar and Start Menu items vbscript + add some local files.e.g.: The proposed \'default-user\' profile environment requires a ".URL\' (.lnk) shortcut placed within the "%ProgramData%\\Microsoft\\Windows\\Start Menu\\Programs*MyNewOWA.url*", and the\n"C:\\Users\\Public\\Desktop\\*MyNewOWA.url*" locations, amongst other itemsThe users have multiple machines within the domain, where only these set \'workroom\' PCs require these policies.These folders require \'Admin\' rights to modify, and although the \'Domain User\' is part of the local \'Admin\' group - UAC was the next challenge.Found various adaptations and amalgamated here. I do have some users with BYOD devices as well that required other files with perm issues.\nHave not tested on XP (a little too old an OS), but the code is present, would love feed back.Domain PC\'s should be governed as much as possible by GPO sets.\nWorkgroup/Standalone machines can be governed by this script.Remember, a UAC prompt will pop-up at least once with a BYOD workgroup PC (as soon as the first elevating to \'Admin perms\' is required), but as the local security policy is modified for admin use from this point on, the pop-ups will disappear.A Domain PC should have the GPO "ConsentPromptBehaviorAdmin" policy set within your \'already\' created "Lock-down" policy - as explained in the script \'REFERENCES\' section.Again, run the secedit.exe import of the default \'.inf\' file if you are stuck on the whole "To UAC or Not to UAC" debate :-).btw:\n@boileau\nDo check your failure on the:By running only "%SYSTEMROOT%\\system32\\cacls.exe" or "%SYSTEMROOT%\\system32\\config\\system" or both from the command prompt - elevated or not, check the result across the board.Another way to do this.